# abort script on any command that exits with a non zero value
set -e

export PACKAGES=/var/vcap/packages
export PATH=$PACKAGES/grootfs-build-tools/bin:$PATH

tar xvzf zlib/zlib-1.2.8.tar.gz
(
  cd zlib-1.2.8
  ./configure --prefix=$BOSH_INSTALL_TARGET
  make
  make install prefix=$BOSH_INSTALL_TARGET
)

tar xvzf lzo/lzo-2.09.tar.gz
(
  cd lzo-2.09
  ./configure --prefix=$BOSH_INSTALL_TARGET
  make
  make install prefix=$BOSH_INSTALL_TARGET
)

tar xvzf util-linux/util-linux-2.28.tar.gz
(
  cd util-linux-2.28
  ./autogen.sh
  ./configure --prefix=$BOSH_INSTALL_TARGET
  make
  make install prefix=$BOSH_INSTALL_TARGET
)

tar xvzf e2fsprogs/e2fsprogs-1.43.3.tar.gz
(
  cd e2fsprogs-1.43.3

  export PKG_CONFIG_PATH=${BOSH_INSTALL_TARGET}/lib/pkgconfig
  export LDFLAGS="-L${BOSH_INSTALL_TARGET}/lib"
  export CFLAGS="-I${BOSH_INSTALL_TARGET}/include"

  ./configure --prefix=$BOSH_INSTALL_TARGET \
              --disable-elf-shlibs \
              --disable-libuuid \
              --disable-libblkid
  make
  make install prefix=$BOSH_INSTALL_TARGET
  make install-libs prefix=$BOSH_INSTALL_TARGET
)

